<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Star Collector Challenge</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background: linear-gradient(180deg, #1a1a2e 0%, #0f0f23 100%);
                font-family: 'Arial', sans-serif;
                color: white;
                overflow: hidden;
                touch-action: none;
            }
            .game-container {
                width: 100%;
                max-width: 800px;
                height: 100%;
                max-height: 600px;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 15px;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
                position: relative;
                overflow: hidden;
            }
            #gameCanvas {
                width: 100%;
                height: 100%;
                display: block;
            }
            .ui-panel {
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(255, 255, 255, 0.1);
                padding: 15px;
                border-radius: 10px;
                backdrop-filter: blur(5px);
                z-index: 10;
            }
            .score-display {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            .upgrade-btn {
                background: #4a90e2;
                border: none;
                padding: 8px 16px;
                color: white;
                font-size: 16px;
                border-radius: 5px;
                cursor: pointer;
                transition: background 0.3s ease, transform 0.2s ease;
                margin: 5px 0;
                display: block;
                width: 100%;
                animation: pulse 2s infinite;
            }
            .upgrade-btn:hover {
                background: #357abd;
                transform: scale(1.05);
            }
            .star {
                position: absolute;
                width: 10px;
                height: 10px;
                background: radial-gradient(circle, #ffd700 30%, transparent 70%);
                border-radius: 50%;
                pointer-events: none;
                animation: fadeOut 1s ease forwards;
            }
            .sparkle {
                position: absolute;
                width: 5px;
                height: 5px;
                background: #ffffff;
                border-radius: 50%;
                pointer-events: none;
                animation: sparkleFade 0.5s ease forwards;
            }
            .burst {
                position: absolute;
                width: 20px;
                height: 20px;
                background: radial-gradient(circle, #ffeb3b 20%, transparent 80%);
                border-radius: 50%;
                pointer-events: none;
                animation: burstFade 0.3s ease forwards;
            }
            @keyframes fadeOut {
                0% { opacity: 1; transform: scale(1) rotate(0deg); }
                100% { opacity: 0; transform: scale(2) rotate(180deg); }
            }
            @keyframes sparkleFade {
                0% { opacity: 1; transform: scale(1); }
                100% { opacity: 0; transform: scale(0.5); }
            }
            @keyframes burstFade {
                0% { opacity: 1; transform: scale(1); }
                100% { opacity: 0; transform: scale(3); }
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.03); }
                100% { transform: scale(1); }
            }
            @media (max-width: 600px) {
                .ui-panel {
                    top: 10px;
                    left: 10px;
                    padding: 10px;
                }
                .score-display {
                    font-size: 18px;
                }
                .upgrade-btn {
                    font-size: 14px;
                    padding: 6px 12px;
                }
            }
        </style>
    </head>
    <body>
        <div class="game-container">
            <div class="ui-panel">
                <div class="score-display">Stars: <span id="score">0</span></div>
                <button class="upgrade-btn" id="upgradeClickBtn" onclick="upgradeClick()">Upgrade Click (Cost: <span id="upgradeClickCost">10</span>)</button>
                <button class="upgrade-btn" id="upgradeSpeedBtn" onclick="upgradeSpeed()">Speed Boost (Cost: <span id="upgradeSpeedCost">20</span>)</button>
                <button class="upgrade-btn" id="upgradeMultiplierBtn" onclick="upgradeMultiplier()">Multiplier (Cost: <span id="upgradeMultiplierCost">50</span>)</button>
                <button class="upgrade-btn" id="upgradeSizeBtn" onclick="upgradeSize()">Star Size (Cost: <span id="upgradeSizeCost">30</span>)</button>
            </div>
            <canvas id="gameCanvas"></canvas>
        </div>
        <!-- In the HTML, add new UI elements -->
        <div class="ui-panel">
            <!-- Existing buttons ... -->
            <button class="upgrade-btn" id="autoClickBtn" onclick="upgradeAutoClick()">
                Auto Collector (Cost: <span id="autoClickCost">100</span>)
            </button>
            <button class="upgrade-btn" id="autoSpeedBtn" onclick="upgradeAutoSpeed()">
                Auto Speed (Cost: <span id="autoSpeedCost">150</span>)
            </button>
        </div>

        <script>
        // Add these new variables
        let backgroundStars = [];
        let autoClickRate = 0; // clicks per second
        let autoClickCost = 100;
        let autoSpeedCost = 150;
        const constellationThreshold = 50;

        // Add new UI elements
        const autoClickCostDisplay = document.getElementById('autoClickCost');
        const autoSpeedCostDisplay = document.getElementById('autoSpeedCost');

        // Modify drawBackgroundStars
        function drawBackgroundStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (backgroundStars.length < constellationThreshold) {
                // Draw individual stars
                backgroundStars.forEach(star => {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            } else {
                // Draw constellation (simple Big Dipper as example)
                drawConstellation();
            }
        }

        // New constellation drawing function
        function drawConstellation() {
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 1;
            ctx.beginPath();
            
            // Big Dipper coordinates (relative to canvas size)
            const points = [
                {x: canvas.width * 0.3, y: canvas.height * 0.3},
                {x: canvas.width * 0.35, y: canvas.height * 0.35},
                {x: canvas.width * 0.4, y: canvas.height * 0.35},
                {x: canvas.width * 0.45, y: canvas.height * 0.3},
                {x: canvas.width * 0.5, y: canvas.height * 0.25},
                {x: canvas.width * 0.55, y: canvas.height * 0.3},
                {x: canvas.width * 0.6, y: canvas.height * 0.35}
            ];
            
            ctx.moveTo(points[0].x, points[0].y);
            points.forEach(point => ctx.lineTo(point.x, point.y));
            ctx.stroke();
            
            // Draw stars at points
            points.forEach(point => {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Modify handleInteraction
        function handleInteraction(event) {
            // ... existing code ...
            
            // Add new background star
            const rect = canvas.getBoundingClientRect();
            let x = (event.type === 'touchstart' ? event.touches[0].clientX : event.clientX) - rect.left;
            let y = (event.type === 'touchstart' ? event.touches[0].clientY : event.clientY) - rect.top;
            
            if (backgroundStars.length < constellationThreshold) {
                backgroundStars.push({
                    x: x,
                    y: y,
                    size: Math.random() * 2
                });
            }
            
            drawBackgroundStars();
            // ... rest of existing code ...
        }

        // Add automation
        function startAutomation() {
            setInterval(() => {
                if (autoClickRate > 0) {
                    score += clickValue * multiplier * autoClickRate / 10;
                    scoreDisplay.textContent = Math.floor(score);
                    
                    // Add visual feedback for auto-clicks
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const star = document.createElement('div');
                    star.classList.add('star');
                    star.style.width = `${starSize}px`;
                    star.style.height = `${starSize}px`;
                    star.style.left = `${x}px`;
                    star.style.top = `${y}px`;
                    star.style.animation = `fadeOut ${starFadeTime / 1000}s ease forwards`;
                    gameContainer.appendChild(star);
                    setTimeout(() => star.remove(), starFadeTime);
                }
            }, 100); // Runs 10 times per second
        }

        // New upgrade functions
        function upgradeAutoClick() {
            if (score >= autoClickCost) {
                score -= autoClickCost;
                autoClickRate += 1;
                autoClickCost = Math.floor(autoClickCost * 1.8);
                updateUI();
            } else {
                alert("Not enough stars!");
            }
        }

        function upgradeAutoSpeed() {
            if (score >= autoSpeedCost) {
                score -= autoSpeedCost;
                autoClickRate += 2;
                autoSpeedCost = Math.floor(autoSpeedCost * 1.9);
                updateUI();
            } else {
                alert("Not enough stars!");
            }
        }

        // Modify updateUI
        function updateUI() {
            scoreDisplay.textContent = Math.floor(score);
            upgradeClickCostDisplay.textContent = upgradeClickCost;
            upgradeSpeedCostDisplay.textContent = upgradeSpeedCost;
            upgradeMultiplierCostDisplay.textContent = upgradeMultiplierCost;
            upgradeSizeCostDisplay.textContent = upgradeSizeCost;
            autoClickCostDisplay.textContent = autoClickCost;
            autoSpeedCostDisplay.textContent = autoSpeedCost;
        }

        // Start the automation when page loads
        startAutomation();

        // Modify initCanvas
        function initCanvas() {
            drawBackgroundStars();
        }
        </script>
        <script>
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('score');
            const gameContainer = document.querySelector('.game-container');

            const upgradeClickCostDisplay = document.getElementById('upgradeClickCost');
            const upgradeSpeedCostDisplay = document.getElementById('upgradeSpeedCost');
            const upgradeMultiplierCostDisplay = document.getElementById('upgradeMultiplierCost');
            const upgradeSizeCostDisplay = document.getElementById('upgradeSizeCost');

            // Canvas 크기 동적 설정
            function resizeCanvas() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                initCanvas();
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            let score = 0;
            let clickValue = 1;
            let starFadeTime = 1000; // milliseconds
            let multiplier = 1;
            let starSize = 10;
            let upgradeClickCost = 10;
            let upgradeSpeedCost = 20;
            let upgradeMultiplierCost = 50;
            let upgradeSizeCost = 30;

            // 배경 별 그리기
            function drawBackgroundStars() {
                ctx.fillStyle = 'white';
                for (let i = 0; i < 100; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const size = Math.random() * 2;
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            function initCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackgroundStars();
            }
            initCanvas();

            // 클릭 및 터치 이벤트 처리
            canvas.addEventListener('click', handleInteraction);
            canvas.addEventListener('touchstart', handleInteraction);
            canvas.addEventListener('mousemove', handleMouseMove);

            function handleInteraction(event) {
                event.preventDefault();
                const rect = canvas.getBoundingClientRect();
                let x, y;

                if (event.type === 'touchstart') {
                    x = event.touches[0].clientX - rect.left;
                    y = event.touches[0].clientY - rect.top;
                } else {
                    x = event.clientX - rect.left;
                    y = event.clientY - rect.top;
                }

                // 별 생성
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.width = `${starSize}px`;
                star.style.height = `${starSize}px`;
                star.style.left = `${x}px`;
                star.style.top = `${y}px`;
                star.style.animation = `fadeOut ${starFadeTime / 1000}s ease forwards`;
                gameContainer.appendChild(star);

                // 폭발 효과
                for (let i = 0; i < 5; i++) {
                    const burst = document.createElement('div');
                    burst.classList.add('burst');
                    burst.style.left = `${x + (Math.random() - 0.5) * 20}px`;
                    burst.style.top = `${y + (Math.random() - 0.5) * 20}px`;
                    gameContainer.appendChild(burst);
                    setTimeout(() => burst.remove(), 300);
                }

                // 점수 증가
                score += clickValue * multiplier;
                scoreDisplay.textContent = score;

                setTimeout(() => star.remove(), starFadeTime);
            }

            // 마우스 이동 시 스파클 트레일
            function handleMouseMove(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                sparkle.style.left = `${x}px`;
                sparkle.style.top = `${y}px`;
                gameContainer.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 500);
            }

            // 업그레이드 기능들
            function upgradeClick() {
                if (score >= upgradeClickCost) {
                    score -= upgradeClickCost;
                    clickValue += 1;
                    upgradeClickCost = Math.floor(upgradeClickCost * 1.5);
                    updateUI();
                } else {
                    alert("Not enough stars!");
                }
            }

            function upgradeSpeed() {
                if (score >= upgradeSpeedCost) {
                    score -= upgradeSpeedCost;
                    starFadeTime = Math.max(200, starFadeTime * 0.8); // 최소 200ms
                    upgradeSpeedCost = Math.floor(upgradeSpeedCost * 1.6);
                    updateUI();
                } else {
                    alert("Not enough stars!");
                }
            }

            function upgradeMultiplier() {
                if (score >= upgradeMultiplierCost) {
                    score -= upgradeMultiplierCost;
                    multiplier += 0.5;
                    upgradeMultiplierCost = Math.floor(upgradeMultiplierCost * 1.8);
                    updateUI();
                } else {
                    alert("Not enough stars!");
                }
            }

            function upgradeSize() {
                if (score >= upgradeSizeCost) {
                    score -= upgradeSizeCost;
                    starSize += 5;
                    upgradeSizeCost = Math.floor(upgradeSizeCost * 1.7);
                    updateUI();
                } else {
                    alert("Not enough stars!");
                }
            }

            function updateUI() {
                scoreDisplay.textContent = score;
                upgradeClickCostDisplay.textContent = upgradeClickCost;
                upgradeSpeedCostDisplay.textContent = upgradeSpeedCost;
                upgradeMultiplierCostDisplay.textContent = upgradeMultiplierCost;
                upgradeSizeCostDisplay.textContent = upgradeSizeCost;
            }
        </script>
    </body>
</html>